generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
  shadowDatabaseUrl = env("SHADOW_DATABASE_URL")
}

model Organization {
  id                          Int       @id @default(autoincrement())
  name                        String    @unique
  slug                        String    @unique
  address                     String?
  organizationDocument        OrganizationDocument?  @relation(fields: [organizationDocumentId], references: [id])
  organizationDocumentId      Int?     @unique
  organizationStatus          StatusOrganization
  organizationType            TypeOrganization
  createdAt                   DateTime
  updatedAt                   DateTime
  owner                       User      ?     @relation(name: "Owner", fields: [ownerId], references: [id])
  ownerId                     Int?
  placement                   Placement?      @relation(fields: [placementId], references: [id])
  placementId                 Int?
  users                       User[]
  poses                       Pos[]
  organizationMailConfirms    OrganizationMailConfirm[]
  DeviceApiKey                DeviceApiKey[]
  nomenclatures               Nomenclature[]
  hrWorker                    HrWorker[]
  hrPositions                 HrPosition[]
  ltyProgram                  LTYProgram?    @relation(fields: [ltyProgramId], references: [id])
  ltyProgramId                Int?
}

model Address {
  id           Int           @id @default(autoincrement())
  city         String
  location     String
  pos          Pos?
  lat          String?
  lon          String?
}

model Placement {
  id           Int           @id @default(autoincrement())
  country      String
  region       String
  utc          String
  organization Organization[]
  pos          Pos[]
  clients      LTYUser[]
  hrWorkers    HrWorker[]
}

model OrganizationDocument {
  id                    Int       @id @default(autoincrement())
  organization          Organization?
  rateVat               String
  inn                   String
  okpo                  String
  kpp                   String?
  ogrn                  String
  bik                   String
  correspondentAccount  String
  bank                  String
  settlementAccount     String
  addressBank           String
  documentDoc           String?
  certificateNumber     String?
  dateCertificate       DateTime?
}

model OrganizationMailConfirm {
  id                Int             @id @default(autoincrement())
  email             String          @unique
  organization      Organization    @relation(fields: [organizationId], references: [id])
  organizationId    Int
  confirmString     String          @unique
  name              String
  surname           String?
  middlename        String?
  birthday          DateTime
  phone             String
  roleId            Int
  position          PositionUser
  status            StatusDeviceDataRaw
  createdAt         DateTime
  expireAt          DateTime
}

model User {
  id                Int            @id @default(autoincrement())
  userRole          UserRole       @relation(fields: [userRoleId], references: [id])
  userRoleId        Int
  name              String
  surname           String?
  middlename        String?
  birthday          DateTime
  phone             String
  email             String         @unique
  password          String
  gender            String?
  position          PositionUser?  @default(Operator)
  status            StatusUser?    @default(ACTIVE)
  avatar            String?
  country           String?
  countryCode       Int?
  timezone          Int?
  refreshTokenId    String?
  fcmToken          String?
  receiveNotifications  Int?  @default(1)
  createdAt         DateTime?
  updatedAt         DateTime?
  organizationOwner Organization[] @relation(name: "Owner")
  organizations     Organization[]
  posesCreated      Pos[]          @relation(name: "CreatedByUser")
  posesUpdated      Pos[]          @relation(name: "UpdateByUser")
  posesPermissions  Pos[]
  techTaskExecutor  TechTask[]     @relation(name: "Executor")
  techTaskCreated   TechTask[]     @relation(name: "CreatedByUser")
  techTaskUpdated   TechTask[]     @relation(name: "UpdateByUser")
  incidentWorker    Incident[]     @relation(name: "Worker")
  incidentsCreated  Incident[]     @relation(name: "CreatedByUser")
  incidentsUpdated  Incident[]     @relation(name: "UpdateByUser")
  warehouseManager  Warehouse[]    @relation(name: "Manager")
  warehouseCreated  Warehouse[]     @relation(name: "CreatedByUser")
  warehouseUpdated  Warehouse[]     @relation(name: "UpdateByUser")
  nomenclatureCreated Nomenclature[]  @relation(name: "CreatedByUser")
  nomenclatureUpdated  Nomenclature[]     @relation(name: "UpdateByUser")
  warehouseDocumentResponsible WarehouseDocument[]  @relation(name: "responsibleUser")
  warehouseDocumentCreated WarehouseDocument[]  @relation(name: "CreatedByUser")
  warehouseDocumentUpdated WarehouseDocument[]  @relation(name: "UpdateByUser")
  cashCollectionCreated CashCollection[]  @relation(name: "CreatedByUser")
  cashCollectionUpdated CashCollection[]  @relation(name: "UpdateByUser")
  shiftReports          ShiftReport[]
  shiftReportCreated    ShiftReport[]  @relation(name: "CreatedByUser")
  shiftReportUpdated    ShiftReport[]  @relation(name: "UpdateByUser")
  workDayShiftReportWorker     WorkDayShiftReport[]  @relation(name: "workerUser")
  workDayShiftReportCreated    WorkDayShiftReport[]  @relation(name: "CreatedByUser")
  workDayShiftReportUpdated    WorkDayShiftReport[]  @relation(name: "UpdateByUser")
  reportTemplateTransactions   ReportTemplateTransaction[]
  bonusOpers                   LTYBonusOper[]
  ltyPrograms                  LTYProgram[]
  hrPaymentCreated             HrPayment[]      @relation(name: "CreatedByUser")
  hrPaymentUpdated             HrPayment[]      @relation(name: "UpdatedByUser")
  authorNotifications          Notification[]
  recipientNotifications       UserNotification[]
  notificationTags             UserNotificationTag[]
  managerPapers                ManagerPaper[]
  managerReportPeriod          ManagerReportPeriod[]
  managerPaperCreated          ManagerPaper[]      @relation(name: "CreatedByUser")
  managerPaperUpdated          ManagerPaper[]      @relation(name: "UpdatedByUser")
  managerReportPeriodCreated          ManagerReportPeriod[]      @relation(name: "CreatedByUser")
  managerReportPeriodUpdated          ManagerReportPeriod[]      @relation(name: "UpdatedByUser")
}

model UserMailConfirm {
  id            Int      @id @default(autoincrement())
  email         String   @unique
  confirmString String
  createdAt     DateTime
  expireAt      DateTime
}

model UserRole {
  id              Int              @id @default(autoincrement())
  name            String
  description     String?
  users           User[]
  userPermissions UserPermission[]
}

model UserPermission {
  id        Int              @id @default(autoincrement())
  action    PermissionAction
  object    ObjectPermissions?     @relation(fields: [objectId], references: [id])
  objectId  Int
  userRoles UserRole[]
}

model DevicePermissions {
  id         Int              @id @default(autoincrement())
  action     PermissionAction
  object     ObjectPermissions?   @relation(fields: [objectId], references: [id])
  objectId   Int?
  DeviceRole DeviceRole[]
}

model DeviceRole {
  id                Int                 @id @default(autoincrement())
  name              String
  carWashDevice     CarWashDevice[]
  devicePermissions DevicePermissions[]
}

model ObjectPermissions {
  id                      Int                      @id @default(autoincrement())
  name                    String
  userPermissions         UserPermission[]
  platformUserPermissions PlatformUserPermission[]
  devicePermissions       DevicePermissions[]
}


model Pos {
  id                   Int                   @id @default(autoincrement())
  name                 String
  slug                 String
  timeWork             String                @default("24")
  organization         Organization          @relation(fields: [organizationId], references: [id])
  organizationId       Int
  posMetaData          String?
  timezone             Int
  address              Address?              @relation(fields: [addressId], references: [id])
  addressId            Int?                   @unique
  image                String?
  rating               Int?
  status               StatusPos            @default(VERIFICATE)
  placement            Placement?           @relation(fields: [placementId], references: [id])
  placementId          Int?
  createdAt            DateTime
  updatedAt            DateTime
  createdBy            User                  @relation(name: "CreatedByUser", fields: [createdById], references: [id])
  createdById          Int
  updateBy             User                  @relation(name: "UpdateByUser", fields: [updateById], references: [id])
  updateById           Int
  loyaltyPosPromocodes LoyaltyPosPromocode[]
  carWashPos           CarWashPos?
  usersPermissions     User[]
  techTasks            TechTask[]
  equipmentKnots       EquipmentKnot[]
  incident             Incident[]
  warehouse            Warehouse[]
  cashCollection       CashCollection[]
  shiftReport          ShiftReport[]
  monthlyPlans         MonthlyPlanPos[]
  managerPaper         ManagerPaper[]
}

model MonthlyPlanPos {
  id                   Int                   @id @default(autoincrement())
  pos                  Pos                   @relation(fields: [posId], references: [id])
  posId                Int
  monthDate            DateTime
  monthlyPlan          Int
}

model CarWashPos {
  id              Int              @id @default(autoincrement())
  name            String
  slug            String
  pos             Pos              @relation(fields: [posId], references: [id])
  posId           Int              @unique
  carWashPosType  CarWashPosType   @default(SelfService)
  minSumOrder     Int              @default(50)
  maxSumOrder     Int              @default(500)
  stepSumOrder    Int              @default(10)
  carWashServices CarWashService[]
  carWashDevices  CarWashDevice[]
  currencyCarWashPoses          CurrencyCarWashPos[]
  programTechRates              ProgramTechRate[]
  carWashDeviceProgramTypes            CarWashDeviceProgramsType[]
  programChanges                ProgramChange[]
}

model CarWashService {
  id          Int          @id @default(autoincrement())
  name        String
  code        String
  description String
  carWasPoses CarWashPos[]
}

model CarWashDevice {
  id                            Int                            @id @default(autoincrement())
  name                          String
  carWashDeviceMetaData         String
  status                        String
  ipAddress                     String
  carWashDeviceType             CarWashDeviceType              @relation(fields: [carWashDeviceTypeId], references: [id])
  carWashDeviceTypeId           Int
  carWasPos                     CarWashPos                     @relation(fields: [carWashPosId], references: [id])
  carWashPosId                  Int
  carWashDeviceOperationsEvents CarWashDeviceOperationsEvent[]
  carWashDeviceOperationsCardEvents CarWashDeviceOperationsCardEvent[]
  carWashDeviceProgrammsEvents  CarWashDeviceProgramsEvent[]
  carWashDeviceEvents           CarWashDeviceEvent[]
  carWashDeviceServiceEvent     CarWashDeviceServiceEvent[]
  carWashDeviceMfuEvent         CarWashDeviceMfuEvent[]
  DeviceRole                    DeviceRole?                    @relation(fields: [deviceRoleId], references: [id])
  deviceRoleId                  Int?
  cashCollectionDevice          CashCollectionDevice[]
  workDayShiftReportCashOpers   WorkDayShiftReportCashOper[]
  programChanges                ProgramChange[]
  bonusOpers                    LTYBonusOper[]
  orders                        LTYOrder[]
}

model CarWashDeviceType {
  id                          Int                          @id @default(autoincrement())
  name                        String
  code                        String
  carWashDevices              CarWashDevice[]
  carWashDeviceProgrammsTypes CarWashDeviceProgramsType[]
  currencyCarWashPoses        CurrencyCarWashPos[]
  cashCollectionDeviceTypes   CashCollectionDeviceType[]
}

model DeviceApiKey {
  id             Int          @id @default(autoincrement())
  key            String
  expiryAt       DateTime
  issuedAt       DateTime
  organization   Organization @relation(fields: [organizationId], references: [id])
  organizationId Int
}

model CarWashDeviceOperationsEvent {
  id                           Int                           @id @default(autoincrement())
  carWashDevice                CarWashDevice?                @relation(fields: [carWashDeviceId], references: [id])
  carWashDeviceId              Int?
  operDate                     DateTime
  loadDate                     DateTime
  counter                      BigInt
  operSum                      Int
  confirm                      Int
  isAgregate                   Int
  localId                      Int
  currency                     Currency                      @relation(fields: [currencyId], references: [id])
  currencyId                   Int
  isBoxOffice                  Int
  errNum                       ErrNum?                       @relation(fields: [errNumId], references: [id])
  errNumId                     Int?

  @@unique([carWashDeviceId, operDate, operSum, localId], name: "unique_device_oper_fields")
}

model CarWashDeviceOperationsCardEvent {
  id                           Int                           @id @default(autoincrement())
  carWashDevice                CarWashDevice?                @relation(fields: [carWashDeviceId], references: [id])
  carWashDeviceId              Int?
  operDate                     DateTime
  loadDate                     DateTime
  cardNumber                    String
  discount                     Int
  sum                          Int
  localId                      Int
  operId                       Int
  discountSum                  Int
  totalSum                     Int?
  isBonus                      Int?
  currency                     CurrencyType
  cashback                     Int?
  cashbackPercent              Int?
  errNum                       ErrNum?                       @relation(fields: [errNumId], references: [id])
  errNumId                     Int?

  @@unique([carWashDeviceId, operDate, sum, localId], name: "unique_device_oper_card_fields")
}

model CarWashDeviceProgramsEvent {
  id                             Int                          @id @default(autoincrement())
  carWashDevice                  CarWashDevice?                @relation(fields: [carWashDeviceId], references: [id])
  carWashDeviceId                Int?
  carWashDeviceProgramsType      CarWashDeviceProgramsType?   @relation(fields: [carWashDeviceProgramsTypeId], references: [id])
  carWashDeviceProgramsTypeId    Int?
  beginDate                      DateTime
  loadDate                       DateTime
  endDate                        DateTime
  confirm                        Int
  isPaid                         Int
  localId                        Int
  isAgregate                     Int?
  minute                         Decimal?
  errNum                         ErrNum?                       @relation(fields: [errNumId], references: [id])
  errNumId                       Int?

  @@unique([carWashDeviceId, beginDate, endDate, localId], name: "unique_device_program_fields")
}

model CarWashDeviceProgramsType {
  id                           Int                           @id @default(autoincrement())
  carWashDeviceType            CarWashDeviceType             @relation(fields: [carWashDeviceTypeId], references: [id])
  carWashDeviceTypeId          Int
  name                         String
  code                         String?
  description                  String?
  orderNum                     Int?
  carWashDeviceProgrammsEvents CarWashDeviceProgramsEvent[]
  carWashDeviceServiceEvent     CarWashDeviceServiceEvent[]
  incident                      Incident[]
  programTechRates              ProgramTechRate[]
  carWashPoses                  CarWashPos[]
  programChangeFroms            ProgramChange[]   @relation(name: "programFrom")
  programChangeTos              ProgramChange[]   @relation(name: "programTo")
}

model CarWashDeviceEvent {
  id                       Int                    @id @default(autoincrement())
  carWashDevice            CarWashDevice?          @relation(fields: [carWashDeviceId], references: [id])
  carWashDeviceId          Int?
  carWashDeviceEventType   CarWashDeviceEventType? @relation(fields: [carWashDeviceEventTypeId], references: [id])
  carWashDeviceEventTypeId Int?
  eventDate                DateTime
  loadDate                 DateTime
  localId                  Int
  errNum                   ErrNum?                  @relation(fields: [errNumId], references: [id])
  errNumId                 Int?

  @@unique([carWashDeviceId, eventDate, localId], name: "unique_device_event_fields")
}

model CarWashDeviceEventType {
  id                  Int                  @id @default(autoincrement())
  name                String
  carWashDeviceEvents CarWashDeviceEvent[]
}

model CarWashDeviceServiceEvent {
  id                       Int                    @id @default(autoincrement())
  carWashDevice            CarWashDevice?          @relation(fields: [carWashDeviceId], references: [id])
  carWashDeviceId          Int?
  carWashDeviceProgramsType      CarWashDeviceProgramsType?   @relation(fields: [carWashDeviceProgramsTypeId], references: [id])
  carWashDeviceProgramsTypeId    Int?
  beginDate                DateTime
  endDate                  DateTime
  loadDate                 DateTime
  localId                  Int
  counter                  BigInt
  errNum                   ErrNum?                  @relation(fields: [errNumId], references: [id])
  errNumId                 Int?

  @@unique([carWashDeviceId, beginDate, endDate, localId], name: "unique_device_service_fields")
}

model CarWashDeviceMfuEvent {
  id                       Int                    @id @default(autoincrement())
  carWashDevice            CarWashDevice?          @relation(fields: [carWashDeviceId], references: [id])
  carWashDeviceId          Int?
  cashIn                   Int
  coinOut                  Int
  beginDate                DateTime
  endDate                  DateTime
  loadDate                 DateTime
  localId                  Int
  errNum                   ErrNum?                  @relation(fields: [errNumId], references: [id])
  errNumId                 Int?

  @@unique([carWashDeviceId, beginDate, endDate, localId], name: "unique_device_mfu_fields")
}

model Currency {
  id                            Int                            @id @default(autoincrement())
  code                          String @unique
  name                          String @unique
  currencyType                  CurrencyType
  currencyView                  CurrencyView?
  currencyCarWashPoses          CurrencyCarWashPos[]
  carWashDeviceOperationsEvents CarWashDeviceOperationsEvent[]
}

model CurrencyCarWashPos {
  id                            Int                            @id @default(autoincrement())
  currency                      Currency                       @relation(fields: [currencyId], references: [id])
  currencyId                    Int
  carWashDeviceType             CarWashDeviceType              @relation(fields: [carWashDeviceTypeId], references: [id])
  carWashDeviceTypeId           Int
  coef                          Int
  carWashPos                    CarWashPos                     @relation(fields: [carWashPosId], references: [id])
  carWashPosId                  Int
}

model ErrNum {
  id                            Int                            @id @default(autoincrement())
  message                       String
  code                          String
  carWashDeviceOperationsEvents CarWashDeviceOperationsEvent[]
  carWashDeviceOperationsCardEvents CarWashDeviceOperationsCardEvent[]
  carWashDeviceProgramsEvents  CarWashDeviceProgramsEvent[]
  carWashDeviceEvents           CarWashDeviceEvent[]
  carWashDeviceServiceEvent     CarWashDeviceServiceEvent[]
  carWashDeviceMfuEvent         CarWashDeviceMfuEvent[]
}

model LTYProgram {
  id                        Int               @id @default(autoincrement())
  name                      String
  status                    LTYProgramStatus
  startDate                 DateTime
  lifetimeBonusDays         Int?
  cardTiers                 LTYCardTier[]
  organizations             Organization[]
  managers                  User[]
}

enum LTYProgramStatus {
  ACTIVE
  PAUSE
}

model LoyaltyPosPromocode {
  id                   Int                   @id @default(autoincrement())
  pos                  Pos                   @relation(fields: [posId], references: [id])
  posId                Int
  code                 Int
  promocodeTransaction PromocodeTransaction?
  metaData             String
  discount             Int
  discountType         String
  expiryDate           DateTime
  status               String
  createdAt            DateTime
  updatedAt            DateTime
}

model PromocodeTransaction {
  id                    Int                 @id @default(autoincrement())
  loyaltyPosPromocode   LoyaltyPosPromocode @relation(fields: [loyaltyPosPromocodeId], references: [id])
  loyaltyPosPromocodeId Int                 @unique
  client                LTYUser?               @relation(fields: [clientId], references: [id])
  clientId              Int?                   @unique
  activationDate        DateTime
  status                String
}

model LTYBenefit {
  id                  Int               @id @default(autoincrement())
  benefitType         LTYBenefitType    @default(CASHBACK)
  name                String
  bonus               Int
  benefitActionType   LTYBenefitActionType? @relation(fields: [benefitActionTypeId], references: [id])
  benefitActionTypeId Int?
  cardTiers           LTYCardTier[]
}

enum LTYBenefitType {
  CASHBACK
  DISCOUNT
  GIFT_POINTS
}

model LTYBenefitActionType {
  id          Int       @id @default(autoincrement())
  name        String
  benefites   LTYBenefit[]
  description String?
}

model LTYCardTier {
  id               Int            @id @default(autoincrement())
  name             String
  description      String?
  cards            LTYCard[]
  ltyProgram       LTYProgram     @relation(fields: [ltyProgramId], references: [id])
  ltyProgramId     Int
  limitBenefit     Int
  benefits         LTYBenefit[]
}

model LTYUser {
  id                   Int                    @id @default(autoincrement())
  name                 String
  birthday             DateTime?
  phone                String                 @unique
  email                String?                @unique
  gender               String?
  status               StatusUser?            @default(ACTIVE)
  avatar               String?
  contractType         ContractType           @default(INDIVIDUAL)
  workerCorporate      LTYCorporate?          @relation(fields: [workerCorporateId], references: [id], name: "Worker")
  workerCorporateId    Int?
  comment              String?
  tags                 LTYUserTag[]
  placement            Placement?           @relation(fields: [placementId], references: [id])
  placementId          Int?
  card                 LTYCard?
  refreshTokenId       String?
  createdAt            DateTime?
  updatedAt            DateTime?
  promocodeTransaction PromocodeTransaction[]
  ownerCorporates      LTYCorporate[]         @relation(name: "Owner")
}

enum ContractType {
  INDIVIDUAL
  CORPORATE
}

model LTYCorporate {
  id                   Int                    @id @default(autoincrement())
  name                 String
  inn                  String
  address              String
  owner                LTYUser?               @relation(fields: [ownerId], references: [id], name: "Owner")
  ownerId              Int?
  createdAt            DateTime               @default(now())
  updatedAt            DateTime               @default(now())
  workers              LTYUser[]              @relation(name: "Worker")
}

model LTYUserTag {
  id                   Int                    @id @default(autoincrement())
  name                 String
  color                String
  clients              LTYUser[]
}

model LTYCard {
  id                   Int                    @id @default(autoincrement())
  balance              Int                    @default(0)
  client               LTYUser?               @relation(fields: [clientId], references: [id])
  clientId             Int?                   @unique
  unqNumber            String
  number               String
  type                 LTYCardType            @default(VIRTUAL)
  monthlyLimit         Int?
  createdAt            DateTime?
  updatedAt            DateTime?
  cardTier             LTYCardTier? @relation(fields: [cardTierId], references: [id])
  cardTierId           Int?
  bonusBanks           LTYBonusBank[]
  bonusOpers           LTYBonusOper[]
  orders               LTYOrder[]
  equarings            LTYEquaring[]
}

enum LTYCardType {
  VIRTUAL
  PHYSICAL
}

model LTYBonusBank {
  id                   Int                    @id @default(autoincrement())
  card                 LTYCard?               @relation(fields: [cardId], references: [id])
  cardId               Int?
  sum                  Int
  accrualAt            DateTime
  expiryAt             DateTime
}

model LTYBonusOper {
  id                   Int                    @id @default(autoincrement())
  card                 LTYCard?               @relation(fields: [cardId], references: [id])
  cardId               Int?
  carWashDevice        CarWashDevice?         @relation(fields: [carWashDeviceId], references: [id])
  carWashDeviceId      Int?
  type                 LTYBonusOperType?     @relation(fields: [typeId], references: [id])
  typeId               Int?
  operDate             DateTime
  loadDate             DateTime
  sum                  Int
  comment              String?
  creator              User?                  @relation(fields: [creatorId], references: [id])
  creatorId            Int?
  order                LTYOrder?       @relation(fields: [orderId], references: [id])
  orderId              Int?
}

model LTYBonusOperType {
  id                   Int                    @id @default(autoincrement())
  name                 String
  signOper             SignOperType
  bonusOpers           LTYBonusOper[]
}

enum SignOperType {
  REPLENISHMENT
  DEDUCTION
}

model LTYOrder {
  id                   Int                    @id @default(autoincrement())
  transactionId        String
  sumFull              Int
  sumReal              Int
  sumBonus             Int
  sumDiscount          Int
  sumCashback          Int
  carWashDevice        CarWashDevice          @relation(fields: [carWashDeviceId], references: [id])
  carWashDeviceId      Int
  platform             PlatformType
  card                 LTYCard?               @relation(fields: [cardId], references: [id])
  cardId               Int?
  contractType         ContractType           @default(INDIVIDUAL)
  orderData            DateTime
  createData           DateTime
  orderHandlerStatus   OrderHandlerStatus?
  orderStatus          OrderStatus
  sendAnswerStatus     SendAnswerStatus?
  sendTime             DateTime?
  debitingMoney        DateTime?
  executionStatus      ExecutionStatus?
  reasonError          String?
  executionError       String?
  handlerError         String?
  bonusOpers           LTYBonusOper[]
}

model LTYEquaring {
  id                Int             @id @default(autoincrement())
  card              LTYCard?               @relation(fields: [cardId], references: [id])
  cardId            Int?
  topUpSum          Int
  totalBalance      Int
  paymentGatewayId  String
  createdAt         DateTime        @default(now())
}

enum PlatformType {
  ONVI
  YANDEX
  LUKOIL
}

enum OrderHandlerStatus {
  CREATED
  COMPLETED
  ERROR
}

enum OrderStatus {
  CREATED
  COMPLETED
  CANCELED
}

enum ExecutionStatus {
  COMPLETED
  ERROR
}

enum SendAnswerStatus {
  SENT
  NOT_SENT
}

model Otp {
  id          Int      @id @default(autoincrement())
  phone       String   @unique
  confirmCode String
  createdAt   DateTime
  expireAt    DateTime
}

model PlatformUser {
  id                 Int               @id @default(autoincrement())
  name               String
  surname            String
  middlename         String?
  birthday           DateTime?
  phone              String?           @unique
  email              String            @unique
  password           String
  gender             String
  status             StatusUser?       @default(ACTIVE)
  avatar             String?
  country            String
  countryCode        Int
  timezone           Int
  refreshTokenId     String?
  createdAt          DateTime
  updatedAt          DateTime
  platformUserRole   PlatformUserRole? @relation(fields: [platformUserRoleId], references: [id])
  platformUserRoleId Int?
}

model PlatformUserMailConfirm {
  id            Int      @id @default(autoincrement())
  email         String   @unique
  confirmString String
  createdAt     DateTime
  expireAt      DateTime
}

model PlatformUserRole {
  id                      Int                      @id @default(autoincrement())
  name                    String
  platformUsers           PlatformUser[]
  platformUserPermissions PlatformUserPermission[]
}

model PlatformUserPermission {
  id                Int                  @id @default(autoincrement())
  action            PermissionAction
  object            ObjectPermissions? @relation(fields: [objectId], references: [id])
  objectId          Int
  platformUserRoles PlatformUserRole[]
}

model DeviceDataRaw {
  id                      Int                      @id @default(autoincrement())
  data                    String
  errors                  String?
  status                  StatusDeviceDataRaw
  version                 String
  createdAt               DateTime
  updatedAt               DateTime
  countRow                Int?
  countError              Int?
}

model TechTask {
  id                      Int                      @id @default(autoincrement())
  name                    String
  pos                     Pos?                      @relation(fields: [posId], references: [id])
  posId                   Int?
  type                    TypeTechTask
  status                  StatusTechTask
  period                  Int?
  markdownDescription     String?
  startDate               DateTime
  nextCreateDate          DateTime?
  endSpecifiedDate        DateTime?
  startWorkDate           DateTime?
  sendWorkDate            DateTime?
  executor                User?                    @relation(name: "Executor", fields: [executorId], references: [id])
  executorId              Int?
  createdAt               DateTime
  updatedAt               DateTime
  createdBy               User                     @relation(name: "CreatedByUser", fields: [createdById], references: [id])
  createdById             Int
  updateBy                User                     @relation(name: "UpdateByUser", fields: [updateById], references: [id])
  updateById              Int
  techTaskItemValueToTechTasks       TechTaskItemValueToTechTask[]
  tags                    TechTaskTag[]
}

model TechTaskTag {
  id                   Int                    @id @default(autoincrement())
  name                 String
  code                 String?
  techTasks            TechTask[]
}

enum TypeTechTask {
  ONETIME
  REGULAR
}

enum StatusTechTask {
  ACTIVE
  FINISHED
  PAUSE
  OVERDUE
  RETURNED
}

model TechTaskItemTemplate {
  id                      Int                      @id @default(autoincrement())
  title                   String
  code                    String?
  type                    TypeTechTaskItemTemplate
  group                   GroupTechTaskItemTemplate
  techTaskItemValueToTechTasks       TechTaskItemValueToTechTask[]
}

enum TypeTechTaskItemTemplate {
  Text
  Number
  SelectList
  Checkbox
}

enum GroupTechTaskItemTemplate {
  Check
  PowerConsumption
  Installations
  Softener
  Osmosis
  CarbonFilter
  Chemistry
  Counters
}

model TechTaskItemValueToTechTask {
  id                      Int                      @id @default(autoincrement())
  techTask                TechTask                 @relation(fields: [techTaskId], references: [id])
  techTaskId              Int
  techTaskItemTemplate    TechTaskItemTemplate     @relation(fields: [techTaskItemTemplateId], references: [id])
  techTaskItemTemplateId  Int
  value                   String?
  image                   String?
}

model Incident {
  id                      Int                      @id @default(autoincrement())
  pos                     Pos?                      @relation(fields: [posId], references: [id])
  posId                   Int?
  worker                  User?                     @relation(name: "Worker", fields: [workerId], references: [id])
  workerId                Int?
  appearanceDate          DateTime
  startDate               DateTime
  finishDate              DateTime
  objectName              String
  equipmentKnot           EquipmentKnot?           @relation(fields: [equipmentKnotId], references: [id])
  equipmentKnotId         Int?
  incidentName               IncidentName?               @relation(fields: [incidentNameId], references: [id])
  incidentNameId              Int?
  incidentReason          IncidentInfo?           @relation(name: "Reason", fields: [incidentReasonId], references: [id])
  incidentReasonId        Int?
  incidentSolution        IncidentInfo?         @relation(name: "Solution", fields: [incidentSolutionId], references: [id])
  incidentSolutionId      Int?
  downtime                Int
  comment                 String
  carWashDeviceProgramsType      CarWashDeviceProgramsType?   @relation(fields: [carWashDeviceProgramsTypeId], references: [id])
  carWashDeviceProgramsTypeId    Int?
  createdAt               DateTime
  updatedAt               DateTime
  createdBy               User                  @relation(name: "CreatedByUser", fields: [createdById], references: [id])
  createdById             Int
  updateBy                User                  @relation(name: "UpdateByUser", fields: [updatedById], references: [id])
  updatedById             Int
}

model EquipmentKnot {
  id                      Int                      @id @default(autoincrement())
  name                    String
  poses                   Pos[]
  incidentName            IncidentName[]
  incident                Incident[]
}

model IncidentName {
  id                      Int                      @id @default(autoincrement())
  name                    String
  equipmentKnots          EquipmentKnot[]
  incident                Incident[]
  incidentReasons         IncidentInfo[]
}

model IncidentInfo {
  id                      Int                      @id @default(autoincrement())
  type                    IncidentInfoType
  name                    String
  incidentReason                Incident[]               @relation(name: "Reason")
  incidentSolution              Incident[]               @relation(name: "Solution")
  incidentName            IncidentName[]
}

enum IncidentInfoType {
  Reason
  Solution
}

model ProgramTechRate {
  id                      Int                      @id @default(autoincrement())
  carWashPos                    CarWashPos                     @relation(fields: [carWashPosId], references: [id])
  carWashPosId                  Int
  carWashDeviceProgramsType      CarWashDeviceProgramsType   @relation(fields: [carWashDeviceProgramsTypeId], references: [id])
  carWashDeviceProgramsTypeId    Int
  literRate                      Int?
  concentration                  Int?
}

model ProgramChange {
  id                                Int                            @id @default(autoincrement())
  carWashPos                        CarWashPos                     @relation(fields: [carWashPosId], references: [id])
  carWashPosId                      Int
  carWashDevice                     CarWashDevice                  @relation(fields: [carWashDeviceId], references: [id])
  carWashDeviceId                   Int
  carWashDeviceProgramsTypeFrom     CarWashDeviceProgramsType      @relation(name: "programFrom", fields: [carWashDeviceProgramsTypeFromId], references: [id])
  carWashDeviceProgramsTypeFromId   Int
  carWashDeviceProgramsTypeTo       CarWashDeviceProgramsType      @relation(name: "programTo",fields: [carWashDeviceProgramsTypeToId], references: [id])
  carWashDeviceProgramsTypeToId     Int
}

model Warehouse {
  id                      Int                      @id @default(autoincrement())
  name                    String
  location                String
  manager                 User?                    @relation(name: "Manager", fields: [managerId], references: [id])
  managerId               Int?
  pos                     Pos?                      @relation(fields: [posId], references: [id])
  posId                   Int?
  createdBy               User                     @relation(name: "CreatedByUser", fields: [createdById], references: [id])
  createdById             Int
  updateBy                User                     @relation(name: "UpdateByUser", fields: [updateById], references: [id])
  updateById              Int
  createdAt               DateTime
  updatedAt               DateTime
  inventoryItems          InventoryItem[]
  warehouseDocuments      WarehouseDocument[]
}

model Nomenclature {
  id                      Int                      @id @default(autoincrement())
  name                    String
  sku                     String
  organization            Organization             @relation(fields: [organizationId], references: [id])
  organizationId          Int
  category                Category                 @relation(fields: [categoryId], references: [id])
  categoryId              Int
  supplier                Supplier?                  @relation(fields: [supplierId], references: [id])
  supplierId              Int?
  measurement             MeasurementNomenclature?
  image                   String?
  status                  NomenclatureStatus?        @default(ACTIVE)
  metaData                Json?
  createdAt               DateTime
  createdBy               User                      @relation(name: "CreatedByUser", fields: [createdById], references: [id])
  createdById             Int
  updateBy                User                     @relation(name: "UpdateByUser", fields: [updateById], references: [id])
  updateById              Int
  updatedAt               DateTime
  inventoryItems          InventoryItem[]
  warehouseDocumentDetails      WarehouseDocumentDetail[]
}

enum NomenclatureStatus {
  ACTIVE
  DELETED
}

enum MeasurementNomenclature {
  PIECE
  KILOGRAM
  LITER
  METER
}

model InventoryItem {
  id                      Int                      @id @default(autoincrement())
  nomenclature            Nomenclature             @relation(fields: [nomenclatureId], references: [id])
  nomenclatureId          Int
  quantity                Int
  warehouse               Warehouse                 @relation(fields: [warehouseId], references: [id])
  warehouseId             Int
}

model Category {
  id                      Int                      @id @default(autoincrement())
  name                    String
  description             String?
  ownerCategoryId         Int?
  ownerCategory           Category?                 @relation("OwnerCategory", fields: [ownerCategoryId], references: [id])
  preOwnerCategory        Category[]                 @relation("OwnerCategory")
  nomenclatures           Nomenclature[]
}

model Supplier {
  id                      Int                      @id @default(autoincrement())
  name                    String
  contact                 String
  nomenclatures          Nomenclature[]
}

model WarehouseDocument {
  id                      Int                      @id @default(autoincrement())
  name                    String
  warehouseDocumentType   WarehouseDocumentType
  warehouse               Warehouse?                 @relation(fields: [warehouseId], references: [id])
  warehouseId             Int?
  responsible             User?                      @relation(name: "responsibleUser", fields: [responsibleId], references: [id])
  responsibleId           Int?
  status                  WarehouseDocumentStatus?
  carryingAt              DateTime
  createdAt               DateTime
  updatedAt               DateTime
  createdBy               User                      @relation(name: "CreatedByUser", fields: [createdById], references: [id])
  createdById             Int
  updateBy                User                      @relation(name: "UpdateByUser", fields: [updateById], references: [id])
  updateById              Int
  warehouseDocumentDetails      WarehouseDocumentDetail[]
}

enum WarehouseDocumentStatus {
  CREATED
  SAVED
  SENT
}

enum WarehouseDocumentType {
  WRITEOFF
  INVENTORY
  COMMISSIONING
  RECEIPT
  MOVING
}

model WarehouseDocumentDetail {
  id                      Int                      @id @default(autoincrement())
  warehouseDocument       WarehouseDocument        @relation(fields: [warehouseDocumentId], references: [id])
  warehouseDocumentId     Int
  nomenclature            Nomenclature             @relation(fields: [nomenclatureId], references: [id])
  nomenclatureId          Int
  quantity                Int
  comment                 String?
  metaData                Json?
}

model CashCollection {
  id                        Int                      @id @default(autoincrement())
  oldCashCollectionDate     DateTime?
  cashCollectionDate        DateTime
  sendAt                    DateTime?
  status                    StatusCashCollection
  sumFact                   Int?
  pos                       Pos?                      @relation(fields: [posId], references: [id])
  posId                     Int?
  shortage                  Int?
  sumCard                   Int?
  countCar                  Int?
  averageCheck              Int?
  virtualSum                Int?
  createdAt                 DateTime
  updatedAt                 DateTime
  createdBy                 User                      @relation(name: "CreatedByUser", fields: [createdById], references: [id])
  createdById               Int
  updatedBy                 User                      @relation(name: "UpdateByUser", fields: [updatedById], references: [id])
  updatedById               Int
  cashCollectionDeviceTypes CashCollectionDeviceType[]
  cashCollectionDevices     CashCollectionDevice[]
  managerPaper              ManagerPaper[]
}

enum StatusCashCollection {
  CREATED
  SAVED
  SENT
}

model CashCollectionDeviceType {
  id                      Int                      @id @default(autoincrement())
  cashCollection          CashCollection?          @relation(fields: [cashCollectionId], references: [id])
  cashCollectionId        Int?
  carWashDeviceType       CarWashDeviceType?       @relation(fields: [carWashDeviceTypeId], references: [id])
  carWashDeviceTypeId     Int?
  sumFact                 Int
  sumCoin                 Int
  sumPaper                Int
  shortage                Int
  virtualSum              Int
}

model CashCollectionDevice {
  id                      Int                      @id @default(autoincrement())
  cashCollection          CashCollection?          @relation(fields: [cashCollectionId], references: [id])
  cashCollectionId        Int?
  carWashDevice           CarWashDevice?           @relation(fields: [carWashDeviceId], references: [id])
  carWashDeviceId         Int?
  oldTookMoneyTime        DateTime
  tookMoneyTime           DateTime
  sum                     Int
  sumCoin                 Int
  sumPaper                Int
  sumCard                 Int
  carCount                Int
  virtualSum              Int
}

model ShiftReport {
  id                      Int                      @id @default(autoincrement())
  pos                     Pos?                     @relation(fields: [posId], references: [id])
  posId                   Int?
  startDate               DateTime
  endDate                 DateTime
  users                   User[]
  workDayShiftReport      WorkDayShiftReport[]
  createdAt                 DateTime
  updatedAt                 DateTime
  createdBy                 User                      @relation(name: "CreatedByUser", fields: [createdById], references: [id])
  createdById               Int
  updatedBy                 User                      @relation(name: "UpdateByUser", fields: [updatedById], references: [id])
  updatedById               Int
}

model WorkDayShiftReport {
  id                              Int                      @id @default(autoincrement())
  shiftReport                     ShiftReport?             @relation(fields: [shiftReportId], references: [id])
  shiftReportId                   Int?
  workDate                        DateTime
  typeWorkDay                     TypeWorkDay
  timeWorkedOut                   String?
  startWorkingTime                DateTime?
  endWorkingTime                  DateTime?
  estimation                      TypeEstimation?
  status                          StatusWorkDayShiftReport?
  cashAtStart                     Int?
  cashAtEnd                       Int?
  prize                           Int?
  fine                            Int?
  comment                         String?
  worker                          User?                     @relation(name: "workerUser", fields: [workerId], references: [id])
  workerId                        Int?
  createdAt                       DateTime
  updatedAt                       DateTime
  createdBy                       User                      @relation(name: "CreatedByUser", fields: [createdById], references: [id])
  createdById                     Int
  updatedBy                       User                      @relation(name: "UpdateByUser", fields: [updatedById], references: [id])
  updatedById                     Int
  workDayShiftReportCashOpers     WorkDayShiftReportCashOper[]
}

enum TypeWorkDay {
  WORKING
  WEEKEND
  MEDICAL
  VACATION
  TIMEOFF
  TRUANCY
}

enum TypeEstimation {
  NO_VIOLATION
  GROSS_VIOLATION
  MINOR_VIOLATION
  ONE_REMARK
}

enum StatusWorkDayShiftReport {
  CREATED
  SAVED
  SENT
}

model WorkDayShiftReportCashOper {
  id                      Int                      @id @default(autoincrement())
  workDayShiftReport      WorkDayShiftReport?      @relation(fields: [workDayShiftReportId], references: [id])
  workDayShiftReportId    Int?
  carWashDevice           CarWashDevice?                @relation(fields: [carWashDeviceId], references: [id])
  carWashDeviceId         Int?
  eventDate               DateTime?
  type                    TypeWorkDayShiftReportCashOper
  sum                     Int
  comment                 String?
}

enum TypeWorkDayShiftReportCashOper {
  REFUND
  REPLENISHMENT
}

model ReportTemplate {
  id                      Int                      @id @default(autoincrement())
  name                    String
  category                CategoryReportTemplate
  description             String?
  query                   String
  params                  Json
  createdAt               DateTime
  updatedAt               DateTime
  reportTemplateTransactions    ReportTemplateTransaction[]
}

enum CategoryReportTemplate {
  POS
}

model ReportTemplateTransaction {
  id                      Int                      @id @default(autoincrement())
  reportTemplate          ReportTemplate?          @relation(fields: [reportTemplateId], references: [id])
  reportTemplateId        Int?
  user                    User                     @relation(fields: [userId], references: [id])
  userId                  Int
  reportKey               String?
  startTemplateAt         DateTime
  endTemplateAt           DateTime?
  status                  StatusReportTemplate
}

enum StatusReportTemplate {
  PROGRESS
  DONE
  ERROR
}

model HrWorker {
  id                      Int                      @id @default(autoincrement())
  name                    String
  hrPosition              HrPosition               @relation(fields: [hrPositionId], references: [id])
  hrPositionId            Int
  placement               Placement                @relation(fields: [placementId], references: [id])
  placementId             Int
  organization            Organization             @relation(fields: [organizationId], references: [id])
  organizationId          Int
  startWorkDate           DateTime?
  phone                   String?
  email                   String?
  description             String?
  avatar                  String?
  monthlySalary           Int
  dailySalary             Int
  percentageSalary        Int
  gender                  String?
  citizenship             String?
  passportSeries          String?
  passportNumber          String?
  passportExtradition     String?
  passportDateIssue       DateTime?
  inn                     String?
  snils                   String?
  hrPayment               HrPayment[]
}

model HrPosition {
  id                      Int                      @id @default(autoincrement())
  name                    String
  description             String?
  hrWorkers               HrWorker[]
  organization            Organization?             @relation(fields: [organizationId], references: [id])
  organizationId          Int?
}

model HrPayment {
  id                      Int                      @id @default(autoincrement())
  hrWorker                HrWorker                 @relation(fields: [hrWorkerId], references: [id])
  hrWorkerId              Int
  paymentType             PaymentType
  paymentDate             DateTime
  billingMonth            DateTime
  countShifts             Int
  sum                     Int
  prize                   Int
  fine                    Int
  createdAt               DateTime
  updatedAt               DateTime?
  createdBy               User                      @relation(name: "CreatedByUser", fields: [createdById], references: [id])
  createdById             Int
  updatedBy               User?                      @relation(name: "UpdatedByUser", fields: [updatedById], references: [id])
  updatedById             Int?
}

model Notification {
  id                      Int                      @id @default(autoincrement())
  heading                 String
  body                    String
  scheduledSendAt         DateTime?
  author                  User?                     @relation(fields: [authorId], references: [id])
  authorId                Int?
  userNotifications       UserNotification[]
}

model UserNotification {
  id                      Int                      @id @default(autoincrement())
  notification            Notification             @relation(fields: [notificationId], references: [id])
  notificationId          Int
  user                    User                     @relation(fields: [userId], references: [id])
  userId                  Int
  sendAt                  DateTime
  openingAt               DateTime?
  type                    UserNotificationType?
  tags                    UserNotificationTag[]
}

enum UserNotificationType {
  DEFAULT
  FAVORITE
  DELETED
}

model UserNotificationTag {
  id                   Int                    @id @default(autoincrement())
  name                 String
  color                String
  authorUser           User                   @relation(fields: [authorUserId], references: [id])
  authorUserId         Int
  userNotifications    UserNotification[]
}

model ManagerPaper {
  id                   Int                    @id @default(autoincrement())
  group                ManagerPaperGroup
  pos                  Pos                    @relation(fields: [posId], references: [id])
  posId                Int
  paperType            ManagerPaperType       @relation(fields: [paperTypeId], references: [id])
  paperTypeId          Int
  eventDate            DateTime
  sum                  Int
  user                 User                   @relation(fields: [userId], references: [id])
  userId               Int
  cashCollection       CashCollection?        @relation(fields: [cashCollectionId], references: [id])
  cashCollectionId     Int?
  imageProductReceipt  String?
  comment              String?
  createdAt            DateTime
  updatedAt            DateTime
  createdBy            User                      @relation(name: "CreatedByUser", fields: [createdById], references: [id])
  createdById          Int
  updatedBy            User?                      @relation(name: "UpdatedByUser", fields: [updatedById], references: [id])
  updatedById          Int?
}

enum ManagerPaperGroup {
  RENT
  REVENUE
  WAGES
  INVESTMENT_DEVIDENTS
  UTILITY_BILLS
  TAXES
  ACCOUNTABLE_FUNDS
  REPRESENTATIVE_EXPENSES
  SALE_EQUIPMENT
  MANUFACTURE
  OTHER
  SUPPLIES
  P_C
  WAREHOUSE
  CONSTRUCTION
  MAINTENANCE_REPAIR
  TRANSPORTATION_COSTS
}

model ManagerPaperType {
  id                   Int                    @id @default(autoincrement())
  name                 String
  type                 ManagerPaperTypeClass
  managerPaper         ManagerPaper[]
}

enum ManagerPaperTypeClass {
  RECEIPT
  EXPENDITURE
}

model ManagerReportPeriod {
  id                   Int                    @id @default(autoincrement())
  status               ManagerReportPeriodStatus
  startPeriod          DateTime
  endPeriod            DateTime
  sumStartPeriod       Int
  sumEndPeriod         Int
  user                 User                   @relation(fields: [userId], references: [id])
  userId               Int
  createdAt            DateTime
  updatedAt            DateTime
  createdBy            User?                      @relation(name: "CreatedByUser", fields: [createdById], references: [id])
  createdById          Int?
  updatedBy            User?                      @relation(name: "UpdatedByUser", fields: [updatedById], references: [id])
  updatedById          Int?
}

enum ManagerReportPeriodStatus {
  SAVE
  SENT
}

enum PaymentType {
  PAYMENT
  PREPAYMENT
}

enum StatusUser {
  VERIFICATE
  ACTIVE
  BLOCKED
  DELETED
}

enum PositionUser {
  Owner
  Operator
}

enum StatusOrganization {
  VERIFICATE
  PENDING
  ACTIVE
  BLOCKED
  DELETED
}

enum StatusPos {
  VERIFICATE
  ACTIVE
  OFFLINE
  DELETED
}

enum CarWashPosType {
  SelfService
  Portal
  SelfServiceAndPortal
}

enum TypeOrganization {
  LegalEntity
  IndividualEntrepreneur
}

enum CurrencyType {
  CASH
  CASHLESS
  VIRTUAL
}

enum CurrencyView {
  COIN
  PAPER
}

enum PermissionAction {
  manage
  create
  update
  delete
  read
}

enum StatusDeviceDataRaw {
  NEW
  PENDING
  DONE
}